// assembly-line
// ----------------------------------
// v0.0.1
//
// Copyright (c)2015 Mauro Trigo, CityHeroes.
// Distributed under MIT license

(function(t,e){"function"==typeof define&&define.amd?define("assembly-line",["_","moment"],function(a,i){return t.AssemblyLine=e(a,i)}):"object"==typeof exports?module.exports=e(require("_"),require("moment")):t.AssemblyLine=e(_,moment)})(this,function(t,e){var a=function(t,e){return e.split(".").reduce(function(t,e){return t?t[e]:null},t)},i={defaultValue:"",timey:!1,displayDateFormat:"DD/MM/YYYY",displayTimeFormat:"HH:mm:ss",displayDatetimeFormat:"DD/MM/YYYY HH:mm:ss"},n=function(e){this.settings=e||{},t.defaults(this.settings,i)};return n.prototype.process=function(e,a){return t.isArray(e)||(e=[e]),a=a||{},a.filters&&a.filters.length>0&&(e=this._applyFilters(a.filters,e)),a.transformations&&a.transformations.length>0&&(e=this._applyTransformations(a.transformations,e)),a.aggregations&&a.aggregations.length>0&&(e=t.map(a.aggregations,this._applyAggregation,{dataCollection:e})),e},n.prototype._applyFilters=function(e,a){var i=this;return t.each(e,function(t){a=i._applyFilter(t,a)}),t(a).flatten()},n.prototype._applyFilter=function(e,i){return t.filter(i,function(t){var i=a(t,e.path);return i?""+i==""+e.match:!1})},n.prototype._applyTransformations=function(e,a){var i=this,n=t.map(a,function(a){var n={};return t.each(e,function(t){n[t.name]=i._applyTransformation(t,a)}),n});return n},n.prototype._applyTransformation=function(i,n){var r=a(n,i.path)||this.settings.defaultValue;if(!i.operation)return r;switch(i.operation){case"concat":r=t.reduce(t.rest(i.params),function(t,e){return t+" "+a(n,e)},a(n,t.first(i.params)));break;case"date":r!==this.settings.defaultValue&&(r=e(r,this.settings.inputDateFormat).format(this.settings.displayDateFormat));break;case"time":r!==this.settings.defaultValue&&(r=e(r,this.settings.inputDateFormat).format(this.settings.displayTimeFormat));break;case"datetime":r!==this.settings.defaultValue&&(r=e(r,this.settings.inputDateFormat).format(this.settings.displayDatetimeFormat));break;case"timey":r=this.settings.timey?r.substring(0,13)+":00:00":r.substring(0,10);break;case"pick":r=t.map(i.params,function(t){return a(n,t)});break;default:return r}return r},n.prototype._applyAggregation=function(e){if(e.explicit_value)return e.explicit_value;var i=0;switch(e.type){case"count":i=t.size(this.dataCollection);break;case"sum":i=t.reduce(this.dataCollection,function(t,i){return a(i,e.path)+t},0);break;case"multiply":i=t.reduce(this.dataCollection,function(t,i){return a(i,e.path)*t},1)}return i},n});
//@ sourceMappingURL=./dist/assembly-line.min.map